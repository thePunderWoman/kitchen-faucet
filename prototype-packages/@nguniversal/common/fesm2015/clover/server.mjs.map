{"version":3,"file":"server.mjs","sources":["../../../../../../../modules/common/clover/server/src/custom-resource-loader.ts","../../../../../../../modules/common/clover/server/src/inline-css-processor.ts","../../../../../../../modules/common/clover/server/src/stubs.ts","../../../../../../../modules/common/clover/server/src/server-engine.ts","../../../../../../../modules/common/clover/server/public_api.ts","../../../../../../../modules/common/clover/server/index.ts","../../../../../../../modules/common/clover/server/server.ts"],"sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport { promises } from 'fs';\nimport { AbortablePromise, FetchOptions, ResourceLoader } from 'jsdom';\nimport { normalize } from 'path';\n\nexport class CustomResourceLoader extends ResourceLoader {\n  constructor(\n    readonly headers: Record<string, string | undefined | string[]> | undefined,\n    private readonly publicPath: string,\n    private readonly baseUrl: string,\n    private readonly fileCache: Map<string, Buffer>,\n  ) {\n    super({\n      userAgent: headers?.['user-agent'] as string | undefined,\n    });\n  }\n\n  fetch(url: string, _options: FetchOptions): AbortablePromise<Buffer> | null {\n    if (!url.endsWith('.js') || !url.startsWith(this.baseUrl)) {\n      return null;\n    }\n\n    const path = normalize(url.replace(this.baseUrl, this.publicPath));\n    if (this.fileCache.has(path)) {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      const filePromise = Promise.resolve(this.fileCache.get(path)!) as AbortablePromise<Buffer>;\n      filePromise.abort = () => undefined;\n\n      return filePromise;\n    }\n\n    const promise = promises.readFile(path, 'utf-8').then((content) => {\n      if (path.includes('runtime.')) {\n        // JSDOM doesn't support type=module, which will be added to lazy loaded scripts.\n        // https://github.com/jsdom/jsdom/issues/2475\n        content = content.replace(/\\.type\\s?=\\s?['\"]module[\"']/, '');\n      }\n\n      this.fileCache.set(path, Buffer.from(content));\n\n      return content;\n    }) as AbortablePromise<Buffer>;\n\n    promise.abort = () => undefined;\n\n    return promise;\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport Critters from 'critters';\nimport { promises } from 'fs';\n\nexport interface InlineCriticalCssProcessOptions {\n  outputPath?: string;\n}\n\nexport interface InlineCriticalCssProcessorOptions {\n  minify?: boolean;\n  deployUrl?: string;\n}\n\nexport interface InlineCriticalCssResult {\n  content: string;\n  warnings?: string[];\n  errors?: string[];\n}\n\nclass CrittersExtended extends Critters {\n  readonly warnings: string[] = [];\n  readonly errors: string[] = [];\n\n  constructor(\n    private readonly optionsExtended: InlineCriticalCssProcessorOptions &\n      InlineCriticalCssProcessOptions,\n    private readonly resourceCache: Map<string, Buffer>,\n  ) {\n    super({\n      logger: {\n        warn: (s: string) => this.warnings.push(s),\n        error: (s: string) => this.errors.push(s),\n        info: () => {},\n      },\n      logLevel: 'warn',\n      path: optionsExtended.outputPath,\n      publicPath: optionsExtended.deployUrl,\n      compress: !!optionsExtended.minify,\n      pruneSource: false,\n      reduceInlineStyles: false,\n      mergeStylesheets: false,\n      preload: 'media',\n      noscriptFallback: true,\n      inlineFonts: true,\n    });\n  }\n\n  public override async readFile(path: string): Promise<string> {\n    let resourceContent = this.resourceCache.get(path);\n    if (resourceContent === undefined) {\n      resourceContent = await promises.readFile(path);\n      this.resourceCache.set(path, resourceContent);\n    }\n\n    return resourceContent.toString();\n  }\n}\n\nexport class InlineCriticalCssProcessor {\n  constructor(\n    protected readonly options: InlineCriticalCssProcessorOptions,\n    private readonly resourceCache: Map<string, Buffer>,\n  ) {}\n\n  async process(\n    html: string,\n    options: InlineCriticalCssProcessOptions,\n  ): Promise<InlineCriticalCssResult> {\n    const critters = new CrittersExtended({ ...this.options, ...options }, this.resourceCache);\n    const content = await critters.process(html);\n\n    return {\n      content,\n      errors: critters.errors.length ? critters.errors : undefined,\n      warnings: critters.warnings.length ? critters.warnings : undefined,\n    };\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport { DOMWindow } from 'jsdom';\n\nfunction noop(): void {}\n\nexport function augmentWindowWithStubs(window: DOMWindow): void {\n  window.resizeBy = noop;\n  window.resizeTo = noop;\n  window.scroll = noop;\n  window.scrollBy = noop;\n  window.scrollTo = noop;\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {\n  ɵNGRenderMode as NGRenderMode,\n  ɵNGRenderModeAPI as NGRenderModeAPI,\n} from '@nguniversal/common/clover';\nimport * as fs from 'fs';\nimport { CookieJar, JSDOM } from 'jsdom';\nimport * as path from 'path';\nimport { URL } from 'url';\nimport { CustomResourceLoader } from './custom-resource-loader';\nimport { InlineCriticalCssProcessor } from './inline-css-processor';\nimport { augmentWindowWithStubs } from './stubs';\n\nexport interface RenderOptions {\n  headers?: Record<string, string | undefined | string[]>;\n  url: string;\n  inlineCriticalCss?: boolean;\n  htmlFilename?: string;\n  publicPath: string;\n}\n\nexport class Engine {\n  private readonly fileExistsCache = new Map<string, boolean>();\n  private readonly htmlFileCache = new Map<string, string>();\n  private readonly resourceLoaderCache = new Map<string, Buffer>();\n  private readonly inlineCriticalCssProcessor = new InlineCriticalCssProcessor(\n    { minify: true },\n    this.resourceLoaderCache,\n  );\n\n  async render(options: RenderOptions): Promise<string> {\n    const { pathname, origin } = new URL(options.url);\n    const prerenderedSnapshot = await this.getPrerenderedSnapshot(options.publicPath, pathname);\n\n    if (prerenderedSnapshot) {\n      return prerenderedSnapshot;\n    }\n\n    let htmlContent = await this.getHtmlTemplate(\n      options.publicPath,\n      pathname,\n      options.htmlFilename,\n    );\n    const inlineCriticalCss = options.inlineCriticalCss !== false;\n\n    const customResourceLoader = new CustomResourceLoader(\n      options.headers,\n      options.publicPath,\n      origin,\n      this.resourceLoaderCache,\n    );\n\n    let dom: JSDOM | undefined;\n\n    if (inlineCriticalCss) {\n      // Workaround for https://github.com/GoogleChromeLabs/critters/issues/64\n      htmlContent = htmlContent.replace(\n        / media=\"print\" onload=\"this\\.media='all'\"><noscript><link .+?><\\/noscript>/g,\n        '>',\n      );\n    }\n\n    // JSDOM doesn't support type=module\n    // https://github.com/jsdom/jsdom/issues/2475\n    htmlContent = htmlContent.replace(/ type=\"module\"/g, '');\n\n    try {\n      dom = new JSDOM(htmlContent, {\n        runScripts: 'dangerously',\n        resources: customResourceLoader,\n        url: options.url,\n        referrer: options.headers?.referrer as string | undefined,\n        cookieJar: new CookieJar(undefined, {\n          allowSpecialUseDomain: true,\n        }),\n        beforeParse: (window) => {\n          augmentWindowWithStubs(window);\n          window.ngRenderMode = true;\n        },\n      });\n\n      const doc = dom.window.document;\n\n      // 60s timeout.\n      const stablizationTimeout = setTimeout(() => {\n        throw new Error('Angular application failed to stablize after in time.');\n      }, 60000);\n\n      const ngRenderMode = await new Promise<NGRenderModeAPI>((resolve) => {\n        const interval = setInterval(() => {\n          const ngDOMMode = dom?.window.ngRenderMode as NGRenderMode;\n          if (ngDOMMode && typeof ngDOMMode === 'object') {\n            // Poll until ngDOMMode is an object.\n            clearTimeout(stablizationTimeout);\n            clearInterval(interval);\n            resolve(ngDOMMode);\n          }\n        }, 30);\n      });\n\n      await ngRenderMode.getWhenStable();\n      doc.querySelector('[ng-version]')?.setAttribute('ng-clover', '');\n\n      // Add Angular state\n      const state = ngRenderMode.getSerializedState();\n      if (state) {\n        const script = doc.createElement('script');\n        script.id = `${ngRenderMode.appId}-state`;\n        script.setAttribute('type', 'application/json');\n        script.textContent = state;\n        doc.body.appendChild(script);\n      }\n\n      const content = dom.serialize();\n      if (!inlineCriticalCss) {\n        return content;\n      }\n\n      const baseHref = doc.querySelector('base[href]')?.getAttribute('href') ?? '';\n      const {\n        content: contentWithInlineCSS,\n        warnings,\n        errors,\n      } = await this.inlineCriticalCssProcessor.process(content, {\n        outputPath: path.join(options.publicPath, baseHref),\n      });\n\n      // eslint-disable-next-line no-console\n      warnings?.forEach((m) => console.warn(m));\n      // eslint-disable-next-line no-console\n      errors?.forEach((m) => console.error(m));\n\n      return contentWithInlineCSS;\n    } finally {\n      dom?.window.close();\n    }\n  }\n\n  private async getPrerenderedSnapshot(\n    publicPath: string,\n    pathname: string,\n  ): Promise<string | undefined> {\n    // Remove leading forward slash.\n    const pagePath = path.resolve(publicPath, pathname.substring(1), 'index.html');\n    const content = await this.readHTMLFile(pagePath);\n\n    return content?.includes('ng-version=')\n      ? content // Page is pre-rendered\n      : undefined;\n  }\n\n  private async getHtmlTemplate(\n    publicPath: string,\n    pathname: string,\n    htmlFilename = 'index.html',\n  ): Promise<string> {\n    const files = [path.join(publicPath, htmlFilename)];\n\n    const potentialLocalePath = pathname.split('/', 2)[1]; // potential base href\n    if (potentialLocalePath) {\n      files.push(path.join(publicPath, potentialLocalePath, htmlFilename));\n    }\n\n    for (const file of files) {\n      const content = await this.readHTMLFile(file);\n      if (content) {\n        return content;\n      }\n    }\n\n    throw new Error(`Cannot file HTML file. Looked in: ${files.join(', ')}`);\n  }\n\n  private async fileExists(filePath: string): Promise<boolean> {\n    const fileExists = this.fileExistsCache.get(filePath);\n    if (fileExists === undefined) {\n      try {\n        await fs.promises.access(filePath, fs.constants.F_OK);\n        this.fileExistsCache.set(filePath, true);\n\n        return true;\n      } catch {\n        this.fileExistsCache.set(filePath, false);\n\n        return false;\n      }\n    }\n\n    return fileExists;\n  }\n\n  private async readHTMLFile(filePath: string): Promise<string | undefined> {\n    if (this.htmlFileCache.has(filePath)) {\n      return this.htmlFileCache.get(filePath);\n    }\n\n    if (await this.fileExists(filePath)) {\n      const content = await fs.promises.readFile(filePath, 'utf-8');\n      this.htmlFileCache.set(filePath, content);\n\n      return content;\n    }\n\n    return undefined;\n  }\n}\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nexport { RenderOptions, Engine } from './src/server-engine';\n","/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nexport * from './public_api';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}